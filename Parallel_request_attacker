import requests
import time
from concurrent.futures import ThreadPoolExecutor, as_completed
from http.cookies import SimpleCookie
# --- Step 1: Define Full Cookie String ---
cookie_header = '''Apache=; _yjsu_yjad=; dd_anonymous_id=; ss_cip=; _fbp=; ELOQUA=; _ga_2NPKD7C4PN=; _ga; _gcl_au=; _ga_7NMP2MSYPM=; _rdt_uuid=; _uetvid=; _hjSessionUser_128718=; mf_user=|; _clck=; ambassador_session.auth0-portal-portal-host-oauth2-filter.ambassador=; ambassador_xsrf.auth0-portal-portal-host-oauth2-filter.ambassador='''

# --- Step 2: Parse Ambassador Tokens ---
cookie = SimpleCookie()
cookie.load(cookie_header)
ambassador_xsrf = cookie.get("ambassador_xsrf.auth0-portal-portal-host-oauth2-filter.ambassador").value

# --- Step 3: Define Request Details ---
url = ""

headers = {
    "Content-Type": "application/json",
    "Accept": "application/json",
    "Origin": "origin",
    "Referer": "Referer",
    "User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36",
    "X-XSRF-TOKEN": ambassador_xsrf,
    "Cookie": cookie_header
}

# --- Step 4: Function to Send a Single Request ---
def send_request(i):
    payload = {
       "user_id": "",
  "user_name": "Sample_ukser",
  "role_type": "user"
    }
    start_time = time.time()
    try:
        response = requests.post(url, json=payload, headers=headers)
        elapsed = time.time() - start_time
        status = "✅" if response.status_code < 400 else "❌"
        return {
            "id": i,
            "status": status,
            "code": response.status_code,
            "text": response.text[:100],
            "time": elapsed
        }
    except Exception as e:
        elapsed = time.time() - start_time
        return {
            "id": i,
            "status": "❌",
            "code": "Exception",
            "text": str(e),
            "time": elapsed
        }

# --- Step 5: Run 100 Requests in Parallel ---
def run_parallel_requests():
    results = []
    with ThreadPoolExecutor(max_workers=100) as executor:
        futures = [executor.submit(send_request, i) for i in range(1, 101)]
        for future in as_completed(futures):
            results.append(future.result())
    return results

# --- Step 6: Execute and Print Summary ---
if __name__ == "__main__":
    responses = run_parallel_requests()
    success_count = sum(1 for r in responses if r["status"] == "✅")
    error_count = len(responses) - success_count
    times = [r["time"] for r in responses]
    avg_time = sum(times) / len(times)
    min_time = min(times)
    max_time = max(times)

    print("\n--- Summary ---")
    print(f"✅ Success: {success_count}")
    print(f"❌ Errors: {error_count}")
    print(f"⏱️ Avg Response Time: {avg_time:.2f} sec")
    print(f"🚀 Fastest: {min_time:.2f} sec")
    print(f"🐢 Slowest: {max_time:.2f} sec\n")

    for r in responses:
        print(f"{r['status']} Request {r['id']}: {r['code']} - {r['text']} ({r['time']:.2f} sec)")
